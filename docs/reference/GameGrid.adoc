= GameGrid Module
:toc: macro
:toc-title: Table of Contents
:icons: font
:source-highlighter: highlight.js

toc::[]

The `GameGrid` module manages the state of the 2D grid which is central to most retro games. It handles cell values, colors, and row/column manipulations.

== Core Concepts

* **Coordinates**: `{ x: number, y: number }` objects. (0,0) is top-left.
* **Cells**: Objects containing `{ value: number, color: string }`.
** `value > 0`: Active (occupied).
** `value === 0`: Inactive (empty).

== API Reference

=== `width: number`

Read-only property returning the number of columns in the grid.

**Returns**

`number` - Grid width.

=== `height: number`

Read-only property returning the number of rows in the grid.

**Returns**

`number` - Grid height.

=== `resetGrid(): void`

Resets the entire grid to its empty state based on configuration.

**Behavior**

Clears all cells and populates them with default empty cell objects.

=== `getGrid(): Cell[][]`

Returns the full 2D array of cells.

**Returns**

`Cell[][]` - The matrix representing the grid.

**Behavior**

Provides direct access to the internal grid state.

**Example**

[source,typescript]
----
const gridState = this.modules.grid.getGrid();
----

=== `forEach(callback: (cell: Cell) => void): void`

Iterates over every cell and executes the provided callback.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`callback` |`(cell: Cell) => void` |Function to run for each cell.
|===

=== `getCell(coordinate: Coordinate): Cell | null`

Returns a `Cell` object or `null` if out of bounds.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Point `{x, y}` to query.
|===

**Returns**

`Cell | null` - The cell object or null.

**Behavior**

Safe accessor that checks bounds before access.

=== `isValidCoordinate(coordinate: Coordinate): boolean`

Returns `true` if the coordinate is within grid bounds.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Point `{x, y}` to check.
|===

**Returns**

`boolean` - Validity of coordinate.

=== `setCellValue(coordinate: Coordinate, value: number): void`

Sets the numeric value of a cell.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Target position.
|`value` |`number` |New numeric value (e.g., `1` for active).
|===

**Behavior**

Updates the `value` property. Ignores out-of-bounds coordinates.

=== `setCellColor(coordinate: Coordinate, color: Color): void`

Sets the color of a cell.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Target position.
|`color` |`Color` |Enum value from `Color`.
|===

**Behavior**

Updates the `color` property of the cell.

=== `isCellActive(coordinate: Coordinate): boolean`

Checks if a specific cell contains an active value (> 0).

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Point to check.
|===

**Returns**

`boolean` - `true` if active.

=== `isCellInactive(coordinate: Coordinate): boolean`

Checks if a specific cell is empty (value === 0).

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinate` |`Coordinate` |Point to check.
|===

**Returns**

`boolean` - `true` if inactive.

=== `isRowFull(y: number): boolean`

Checks if a row has no empty cells.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`y` |`number` |Row index to check.
|===

**Returns**

`boolean` - `true` if all cells in row > 0.

=== `isRowEmpty(y: number): boolean`

Checks if all cells in a row are empty.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`y` |`number` |Row index to check.
|===

**Returns**

`boolean` - `true` if row is empty.

=== `clearRow(y: number): void`

Resets all cells in a specific row.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`y` |`number` |Row index to clear.
|===

=== `shiftRowsDown(fromY: number): void`

Shifts rows down starting from `fromY`.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`fromY` |`number` |The starting row index.
|===

**Behavior**

Moves row `y-1` to `y` for all `y <= fromY`. Top row becomes empty.

=== `shiftRowsUp(fromY: number): void`

Shifts rows up starting from `fromY`.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`fromY` |`number` |The starting row index.
|===

**Behavior**

Moves row `y+1` to `y` for all `y >= fromY`. Bottom row becomes empty.

=== `clearFullRows(): number`

Scans grid, clears full rows, and shifts everything down.

**Returns**

`number` - Count of cleared rows.

=== `isColumnFull(x: number): boolean`

Checks if a column has no empty cells.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`x` |`number` |Column index.
|===

**Returns**

`boolean` - `true` if full.

=== `isColumnEmpty(x: number): boolean`

Checks if all cells in a column are empty.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`x` |`number` |Column index.
|===

**Returns**

`boolean` - `true` if empty.

=== `clearColumn(x: number): void`

Resets all cells in a specific column.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`x` |`number` |Column index to clear.
|===

=== `shiftColumnsRight(fromX: number): void`

Shifts columns to the right starting from `fromX`.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`fromX` |`number` |The starting column index.
|===

=== `shiftColumnsLeft(fromX: number): void`

Shifts columns to the left starting from `fromX`.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`fromX` |`number` |The starting column index.
|===

=== `clearFullColumns(): number`

Scans grid, clears full columns, and shifts everything right.

**Returns**

`number` - Count of cleared columns.

=== `isAreaOccupied(coordinates: Coordinate[]): boolean`

Checks if a shape collides with anything in the grid.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinates` |`Coordinate[]` |Array of points representing the shape.
|===

**Returns**

`boolean` - `true` if collision detected.

=== `fillArea(start: Coordinate, end: Coordinate, value: number, color: Color): void`

Fills a rectangular area defined by two corners.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`start` |`Coordinate` |One corner.
|`end` |`Coordinate` |Opposite corner.
|`value` |`number` |Value to apply.
|`color` |`Color` |Color to apply.
|===

=== `stampPiece(coordinates: Coordinate[], value: number, color: Color): void`

Sets multiple specific coordinates at once.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`coordinates` |`Coordinate[]` |Points to update.
|`value` |`number` |Value to apply.
|`color` |`Color` |Color to apply.
|===


== Example Usage

[source,typescript]
----
const { grid } = this.modules;

// Check collision
if (grid.isAreaOccupied(nextPieceCoordinates)) {
    // Collision detected!
}

// Lock piece into grid
grid.stampPiece(currentPieceCoordinates, 1, Color.RED);

// Clear lines
const linesCleared = grid.clearFullRows();
if (linesCleared > 0) {
    // Add score
}
----

=== `getDebugData(): Record<string, string | number | boolean>`

Returns the debug data for the module.

**Returns**

`Record<string, string | number | boolean>` - Object containing `width` and `height`.
----
