= GameState Module
:toc: macro
:toc-title: Table of Contents
:icons: font
:source-highlighter: highlight.js

toc::[]

The `GameState` module acts as the central hub for tracking the game's lifecycle and user preferences. It handles persistence to `localStorage` for settings like sound and color mode.

== State Concepts

The module manages internal states that represent the game's current status. These are accessed via specific validation methods:

* **On**: Is the device turned "on"?
* **Started**: Has the "Start" button been pressed (gameplay session active)?
* **Playing**: Is the game loop actively updating logic?
* **Paused**: Is the game started but not playing?
* **Game Over**: Has the player lost?

It also manages user preferences:

* **Muted**: Is sound disabled? (Persisted)
* **Color Enabled**: Is color mode active? (Persisted)
* **High Score**: The highest score achieved by the player. (Persisted)

NOTE: Modifying these states automatically triggers the notification system, informing all subscribers.

== API Reference

=== `isOn(): boolean`

Checks if the game system is "on" (powered up).

**Returns**

`boolean` - True if system is on.

=== `isOff(): boolean`

Checks if the game system is "off" (powered down).

**Returns**

`boolean` - True if system is off.

=== `isStarted(): boolean`

Checks if a game session has started (passed menu/title screen).

**Returns**

`boolean` - True if game is started.

=== `isPlaying(): boolean`

Checks if the game is currently playing (active gameplay logic).

**Returns**

`boolean` - True if gameplay is active.

=== `isPaused(): boolean`

Checks if the game is paused (started but not playing, and not game over).

**Returns**

`boolean` - True if game is paused.

=== `isGameOver(): boolean`

Checks if the game has reached a game over state.

**Returns**

`boolean` - True if game over.

=== `turnOn(): void`

Turns the game system on. Resets other states.

**Behavior**

Sets `on` to true. Resets `start`, `playing`, `gameOver` to false.

=== `turnOff(): void`

Turns the game system off.

**Behavior**

Sets `on` to false. Resets `start`, `playing`, `gameOver` to false.

=== `startGame(): void`

Starts a new game session from the menu.

**Behavior**

Sets `start` to true and `playing` to true. Ensures `gameOver` is false. Only works if system is `on`.

=== `exitGame(): void`

Exits the current game session and returns to the menu.

**Behavior**

Sets `start`, `playing`, and `gameOver` to false.

=== `pause(): void`

Pauses the current game.

**Behavior**

Sets `playing` to false. Only works if game is started and not game over.

=== `resume(): void`

Resumes the current game.

**Behavior**

Sets `playing` to true. Only works if game is started and not game over.

=== `triggerGameOver(): void`

Triggers the game over state.

**Behavior**

Sets `playing` to false and `gameOver` to true.

=== `resetGame(): void`

Resets the game state for a new round (e.g. after Game Over).

**Behavior**

Sets `gameOver` to false, `start` to true, and `playing` to true.

=== `isColorEnabled(): boolean`

Checks if color rendering is enabled.

**Returns**

`boolean` - True if color is enabled.

=== `setColorEnabled(value: boolean): void`

Sets whether color rendering is enabled.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`value` |`boolean` |The new value.
|===

**Behavior**

Updates the setting and persists it to `localStorage`.

=== `isMuted(): boolean`

Checks if audio is muted.

**Returns**

`boolean` - True if audio is muted.

=== `setMuted(value: boolean): void`

Sets whether audio is muted.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`value` |`boolean` |The new value.
|===

**Behavior**

Updates the setting and persists it to `localStorage`.

=== `getHighScore(): number`

Gets the highest score achieved.

**Returns**

`number` - The high score.

=== `setHighScore(value: number): void`

Sets the high score.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`value` |`number` |The new high score.
|===

**Behavior**

Updates the value and persists it to `localStorage`.

=== `subscribe(property: StateProperty, callback: (value: boolean | number) => void): void`

Subscribes to changes in a specific state property.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`property` |`StateProperty` |The state property to monitor.
|`callback` |`(value: boolean \| number) => void` |Function to execute when the property changes.
|===

**Example**

[source,typescript]
----
state.subscribe(StateProperty.GAME_OVER, isOver => {
    if (isOver) {
        console.log('Game Over!');
    }
});
----

=== `unsubscribe(property: StateProperty, callback: (value: boolean | number) => void): void`

Unsubscribes a previously registered callback.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`property` |`StateProperty` |The state property.
|`callback` |`(value: boolean \| number) => void` |The function reference to remove.
|===

=== `setPersistenceKey(key: string): void`

Sets the unique persistence key for the game.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`key` |`string` |The unique identifier for the game instance.
|===

=== `getPersistenceKey(): string`

Returns the currently set persistence key.

**Returns**

`string` - The persistence key.
