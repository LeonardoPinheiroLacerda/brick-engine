= GameRenderer Module
:toc: macro
:toc-title: Table of Contents
:icons: font
:source-highlighter: highlight.js

toc::[]

The `GameRenderer` module handles the visualization of the game state on the HTML5 canvas using P5.js.

It follows a **Strategy Composite** pattern, allowing multiple render layers, but the primary renderer is `DisplayRenderer`.

== Features

* **Automatic Scaling**: Adjusts the game grid to fit the container while maintaining aspect ratio.
* **Retro Styling**: Renders cells with a grid gap and "LCD" style look.
* **Metrics**: Exposes calculated dimensions for other modules (like Text) to align content correctly.

== Implementation Details

For developers interested in the specific rendering logic of the game grid and HUD, refer to:

* xref:DisplayRenderer.adoc[DisplayRenderer]: Handles the main game grid and cell rendering.
* xref:HudRenderer.adoc[HudRenderer]: Handles the HUD layout and static elements.

== API Reference

=== `addRenderer(renderer: Renderer): void`

Adds a new rendering layer to the stack.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`renderer` |`Renderer` |The renderer implementation to add.
|===

**Behavior**

Appends the renderer to the internal list. Renderers are executed in the order they were added.

=== `render(grid: Cell[][]): void`

Called automatically by the main `Game` loop. Draws the current state of the grid.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`grid` |`Cell[][]` |The 2D array of cells to render.
|===

**Behavior**

Iterates through all registered renderers and calls their `render()` method with the grid.

**Example**

[source,typescript]
----
this.modules.renderer.render(currentGrid);
----

=== `rendererMetrics: RendererMetrics`

Read-only property containing calculated dimensions.

**Returns**

`RendererMetrics` - Object with display, hud, and cell dimensions.

**Behavior**

Values are calculated during `setup()` based on screen size and configuration. The `GameRenderer` calculates these once and passes them to all child renderers, ensuring a single source of truth for layout metrics.

**Example**

[source,typescript]
----
const { cell } = this.modules.renderer.rendererMetrics;
const pixelX = gridX * cell.size;
----

[source,typescript]
----
const { renderer } = this.modules;
const { cell } = renderer.rendererMetrics;

// Draw a custom effect at grid position (5, 5)
p5.circle(5 * cell.size, 5 * cell.size, 10);
----

=== `getDebugData(): Record<string, string | number | boolean>`

Returns the debug data for the module.

**Returns**

`Record<string, string | number | boolean>` - Object containing `display_width`, `display_height`, `hud_width`, `hud_height`, and `cell_size`.
