= GameScore Module
:toc: macro
:toc-title: Table of Contents
:icons: font
:source-highlighter: highlight.js

toc::[]

The `GameScore` module tracks the player's current session score, manages game levels and multipliers, and interacts with the `GameState` module to persist high scores.

== State Management

The module maintains:
* `score`: The current session's score (transient).
* `level`: The current game level.
* `multiplier`: The current score multiplier.

== Interaction with GameState

The `GameScore` module follows the engine's architectural pattern of **centralized state persistence**. While it manages session-specific data like the current `score`, it implements the `StateSyncable` interface to link with `GameState` for persistent data.

The `Game` class synchronizes all modules with `GameState` during initialization by calling `syncState(state)` on every module that implements the interface. For the score module, this connection is vital to:

*   **Validate High Scores**: Compare current performance against the persisted `highScore`.
*   **Persist Records**: Automatically update the all-time high score in `GameState` whenever a record is broken.

== API Reference

=== `increaseScore(amount: number): void`

Increases the current score by the specified amount *multiplied by the current multiplier*. Automatically checks and updates the high score in `GameState`.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`amount` |`number` |The base points to add to the score.
|===

**Behavior**

Adds `amount * multiplier` to internal score. If the new score exceeds `state.highScore`, it updates `state.highScore`.

**Example**

[source,typescript]
----
this.modules.score.increaseScore(100);
----

=== `resetScore(): void`

Resets the current session score to 0.

**Behavior**

Sets internal `_score` to 0. Does not affect high score.

**Example**

[source,typescript]
----
this.modules.score.resetScore();
----

=== `getFormattedScore(digits: number = 6): string`

Returns the current score formatted as a string with leading zeros.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`digits` |`number` |The total number of digits (default: 6).
|===

**Returns**

`string` - The formatted score string (e.g., "000150").

**Example**

[source,typescript]
----
text.textOnHud(this.modules.score.getFormattedScore(), { x: 0, y: 0 });
----

=== `multiplier`

Getter and Setter for the score multiplier.

**Type**

`number`

**Example**

[source,typescript]
----
this.modules.score.multiplier = 2; // Double points
----

=== `level`

Getter for the current game level.

**Type**

`number`

=== `increaseLevel(): void`

Increases the current level by the specified amount.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`amount` |`number` |The base points to add to the level.
|===

**Behavior**

Adds `amount` to internal level.

**Example**

[source,typescript]
----
this.modules.score.increaseLevel(1);
----

=== `resetLevel(): void`

Resets the game level to 1.

**Example**

[source,typescript]
----
this.modules.score.resetLevel();
----
=== `setState(state: State): void`

Sets the state module required for the Score context.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`state` |`State` |The game state module.
|===

**Behavior**

Initializes the internal reference to the `GameState` module. This is required for high score validation and persistence.

**Example**

[source,typescript]
----
this.modules.score.setState(this.modules.state);
----

=== `syncState(state: State): void`

Synchronizes the score module with the game state.

**Parameters**

[cols="1,1,3"]
|===
|Name |Type |Description
|`state` |`State` |The game state module.
|===

**Behavior**

Part of the `StateSyncable` interface. Updates the internal state reference. Called automatically by the engine's initialization loop.

**Example**

[source,typescript]
----
this.modules.score.syncState(this.modules.state);
----

=== `getDebugData(): Record<string, string | number | boolean>`

Returns the debug data for the module.

**Returns**

`Record<string, string | number | boolean>` - Object containing `score`, `multiplier`, `level`, and `max_level`.
